{% comment %} {% extends "base.html" %} {% endcomment %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/profile_detail.css' %}">
<script src="{% static 'js/profile_detail.js' %}"></script>
<div class="container">
    <div class="profile-detail">
        <h2 class="text-center">Профиль пользователя: {{ profile.user.username }}</h2>

        <div class="avatar">
            {% if profile.avatar %}
                <img src="{{ profile.avatar.url }}" alt="Avatar" class="avatar-img">
            {% else %}
                <img src="{% static 'img/avatar.jpg' %}" alt="Avatar" class="avatar-img">
            {% endif %}
        </div>

        <div class="followers">
            <p><strong>Подписчики:</strong> <span id="followers-count">{{ profile.followers.count }}</span></p>
        </div>
        {% if profile.user != user %}
        <div class="actions">
            {% if user.is_authenticated %}
                {% if user in profile.followers.all %}
                    <input type="hidden" id="user-id" value="{{ user.id }}">
                    <input type="hidden" id="target-user-id" value="{{ profile.user.id }}">
                    <button id="subscribe" class="btn btn-danger" onclick="toggleSubscription()">Отписаться</button>
                {% else %}
                    <input type="hidden" id="user-id" value="{{ user.id }}">
                    <input type="hidden" id="target-user-id" value="{{ profile.user.id }}">
                    <button id="subscribe" class="btn btn-success" onclick="toggleSubscription()">Подписаться</button>
                {% endif %}
            {% endif %}
        </div>
        {% endif %}
        
        {% if profile.user == user %}
        <div class="profile-info">
            <p><strong>Биография:</strong> {{ profile.bio }}</p>
            <p><strong>Местоположение:</strong> {{ profile.location }}</p>
            <p><strong>Дата рождения:</strong> {{ profile.birth_date }}</p>
            <p><strong>Создан:</strong> {{ profile.created_at }}</p>
            <p><strong>Обновлен:</strong> {{ profile.updated_at }}</p>
        </div>
        <div class="btn btn-primary"><a href="{% url 'profile_app:profile_edit' profile.id %}">Редактировать профиль</a></div>
        <div class="btn btn-primary"><a href="http://127.0.0.1:8001/video/">Создать видео!?"</a></div>
        {% endif %}
    </div>
</div>
<script>
{% comment %} 
// Пример получения токена из куки
function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
}

const token = getCookie('access_token');  // Получаем токен из куки
console.log(token);  // Проверяем, установлен ли токен

const user = {
    id: {{ user.id }},
};

fetch(`http://localhost:8000/profile/${user.id}/`, {
    method: 'GET',
    headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
    }
})
.then(response => {
    console.log('Response Headers:', [...response.headers.entries()]);  // Проверяем, что заголовок установлен
    if (response.status === 401) {
        alert('Unauthorized. Please log in again.');
        window.location.href = '/auth/login';
    }
    return response.json();
})
.then(data => console.log(data))
.catch(error => console.error('Error:', error)); {% endcomment %}


</script>

{% endblock %}
